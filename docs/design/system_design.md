# Chart系统设计文档（前后端分离架构）

## 1. 系统架构设计

### 1.1 总体架构
采用前后端分离的微服务架构：
- **前端**：负责UI展示、用户交互和数据可视化
- **后端**：负责数据处理、文件管理和业务逻辑，基于模块化设计，使用RESTful API进行通信

### 1.2 架构示意图
```
[客户端浏览器] <--HTTP/WebSocket--> [前端服务] <--RESTful API--> [后端服务] <--> [数据库]
                                        |                               |
                                        v                               v
                                  [静态资源CDN]                    [文件存储服务]
```

### 1.3 通信方式选择
本系统选择RESTful API作为前后端通信方式，主要考虑因素如下：
- **优势**：
  - 对于本系统的医疗数据可视化场景，RESTful API提供了足够的性能
  - 开发效率更高，调试更简单
  - 前端开发人员更容易理解和集成
  - 浏览器原生支持，不需要额外的库
  - 更适合HTTP+JSON的通信模型
  - 系统规模和复杂度下，RESTful API足以满足需求

- **gRPC+Protobuf的适用场景**：
  - 如果未来系统扩展到需要更高性能的微服务间通信
  - 服务间需要严格的接口定义和类型检查
  - 需要双向流通信的更多场景
  - 后端服务之间的内部通信

## 2. 前端设计

### 2.1 技术选型
- 框架：React 18 + TypeScript
- 状态管理：Redux Toolkit
- 数据可视化：D3.js + ECharts
- UI组件库：Ant Design
- 通信：Axios + WebSocket
- 构建工具：Vite

### 2.2 前端架构
- 基于组件化设计模式
- 采用Atomic Design组件分层
- 状态与UI分离

### 2.3 模块结构
```
frontend/
├── public/
├── src/
│   ├── api/           # API请求封装
│   ├── assets/        # 静态资源
│   ├── components/    # 通用组件
│   ├── hooks/         # 自定义Hooks
│   ├── layouts/       # 页面布局
│   ├── pages/         # 页面组件
│   ├── store/         # Redux状态管理
│   ├── types/         # TypeScript类型定义
│   ├── utils/         # 工具函数
│   ├── App.tsx
│   └── main.tsx
└── package.json
```

### 2.4 核心界面设计

#### 2.4.1 主界面
- 顶部导航栏（应用标题、用户信息、系统菜单）
- 左侧边栏（文件浏览、快速导航）
- 中央区域（多通道数据显示）
- 右侧控制面板（参数调整、处理选项）
- 底部状态栏（系统信息、快捷操作）

#### 2.4.2 数据可视化组件
- 多通道波形图组件
- 动态缩放控制器
- 时间轴组件
- 数据标记组件
- 事件注释组件

#### 2.4.3 交互设计
- 拖拽导航
- 缩放控制
- 选区分析
- 参数调整面板
- 数据处理工作流

## 3. 后端设计

### 3.1 技术选型
- 语言：Go 1.24.1
- Web框架：Gin
- 数据库：MySQL + Redis
- 文件存储：MinIO/对象存储
- 消息队列：RabbitMQ（用于大文件处理）
- 容器化：Docker + Kubernetes

### 3.2 模块化设计

#### 3.2.1 核心模块
```
chartsystem/
├── api/            # API路由与控制器
├── config/         # 配置管理
├── internal/
│   ├── middleware/ # 中间件
│   ├── model/      # 数据模型
│   ├── repository/ # 数据访问层
│   ├── service/    # 业务逻辑层
│   └── utils/      # 工具函数
├── pkg/            # 可重用包
│   ├── fileproc/   # 文件处理
│   ├── dataproc/   # 数据处理
│   ├── signal/     # 信号处理
│   └── analysis/   # 数据分析
├── main.go         # 入口文件
├── Dockerfile      # Docker构建文件
└── docker-compose.yml # Docker编排文件
```

#### 3.2.2 业务模块划分
- **用户模块**：认证、授权、用户管理
- **文件模块**：文件上传、存储、管理
- **数据处理模块**：信号处理、滤波、分析算法
- **配置模块**：系统配置
- **可视化服务**：提供数据转换为前端可视化所需格式

#### 3.2.3 数据流处理
- 采用流式处理架构处理大型数据文件
- 实现数据分块加载和处理
- 使用缓存优化频繁访问的数据片段

### 3.3 关键算法设计

#### 3.3.1 数据加载与处理
- 流式数据处理
- 分块加载算法
- 内存映射技术
- 并发处理框架

#### 3.3.2 信号处理算法
- 数字滤波实现（低通、高通、带通）
- FFT频谱分析
- 小波变换
- 平滑去噪算法
- 特征提取算法（适用于心电数据等）

## 4. 通信协议设计

### 4.1 RESTful API
- 遵循REST规范设计API
- 使用JWT进行身份验证
- 标准HTTP状态码
- JSON数据交换格式

### 4.2 WebSocket
- 用于实时数据推送
- 支持数据流式传输
- 状态更新通知

### 4.3 数据交换格式
```json
{
  "metadata": {
    "requestId": "uuid-string",
    "timestamp": 1624567890,
    "version": "1.0"
  },
  "data": {
    // 业务数据
  },
  "pagination": {
    "page": 1,
    "pageSize": 100,
    "total": 1000
  }
}
```

## 5. 安全设计

### 5.1 认证与授权
- 基于JWT的认证机制
- RBAC权限管理
- API访问控制

### 5.2 数据安全
- 传输加密（TLS/SSL）
- 敏感数据加密存储
- 数据访问审计日志

## 6. 扩展性设计

### 6.1 插件系统
- 后端插件接口定义
- 数据处理算法扩展机制
- 前端可视化组件扩展机制

### 6.2 配置系统
- 分层配置管理
- 动态配置加载

## 7. 部署架构

### 7.1 开发环境
- 容器化本地开发环境
- 开发工具链配置

### 7.2 生产环境
- 微服务部署拓扑
- 负载均衡
- 自动扩缩容策略
- 监控与告警 